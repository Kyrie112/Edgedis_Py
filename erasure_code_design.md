# Some Design for Using Erasure Code in Data Distribution
## storage and decode
每个节点需要有两个部分缓存，一个用于存储解码后的原始文件，一个用于存储当前集群中正在转发的数据块(即编码后的数据块)。

在两种存储结构中，数据块存储采用哈希的方式进行存储，其中key是收获到的编码后的数据块号，这一部分的块号是由Client在准备数据分发的时候进行编码的；value是对应的数据块。当检测到接收到的数据块数目达到k时，就可以开始进行数据解码，解码完成之后就可以获得原始数据，将这一部分的原始文件数据存储到列表中（这个不重要了），同时在解码过程中可以将存储到的数据块清空，准备接受接下来的新文件的编码的数据块。

且在此过程中，数据分发的同时需要发送当前文件的文件号，此处可以看成当前文件块的起始编码号，这样每个节点可以根据这个信息，判断自己是否还需要这个文件的数据块（如果已经有文件了，直接给予回复即可，否则需要存储）

## data supplement and recovery
考虑沿用edge dis中的coordinator，coordinator需要在缺少数据的时候去获取数据，此时就需要通过向follower；同时当follower缺少数据的时候需要向coordiantor请求数据，所以可以考虑，在数据恢复的过程中直接做文件数据恢复，不再考虑做块的恢复（考虑到边缘服务器之间的传输速度较快）

其次，了解到纠删码可以利用部分的正确的数据块获得部分的正确数据，是否考虑可以只对没有接受的正确数据块做数据恢复，同时恢复工作如何进行，这个部分可以考虑一下，且这样做是否能够加快数据的恢复速度呢。

## data distribution in P2P protocol
在P2P协议中，集群中的每个节点上存储部分数据块（部分特殊情况下，可能会要求一些节点存储完整的数据），当某一个节点需要某一种数据的时候，就会通过一系列P2P协议中的机制，去向拥有这些数据的节点请求。

以下简单介绍部分P2P协议中的核心思想。
### 对等网络(Peer_to_Peer Network)
* 作用：P2P 网络具有一定的相似性，它们允许节点之间直接通信和共享数据。最经典的思想，应用于BitTorrent中。

* 功能：P2P 网络允许节点直接连接并交换数据，可以用于文件共享、资源共享和分布式计算。
### IPFS(InterPlanetary File System)
* 作用：IPFS 是一个分布式文件系统和通信协议，旨在创建一个全球分布式的、内容寻址的文件系统。它使用哈希链接来定位和访问文件，以取代传统的基于位置的文件系统。

* 工作原理：IPFS 基于 Merkle DAG（有向无环图）的数据结构，通过内容寻址和多层哈希来管理文件和数据。它允许文件分布式存储，并使用内容哈希来检索和访问文件。

* 应用场景：IPFS 主要用于分布式文件存储和共享。它旨在解决传统互联网文件存储中的中心化问题，提供更加分散和去中心化的文件存储方式。此协议关键在于文件数据的存储和共享。
### DHT(分布式哈希)

* 作用：DHT 是一种用于分布式系统中数据存储和检索的协议，用于管理键值对的分布式哈希表。它允许数据分布式地存储在网络中的多个节点上，并提供了高效的数据检索和节点查找功能。

* 工作原理：DHT 将数据分布式存储在网络中的节点上，通过一种分布式的键值对映射来定位和检索数据。它使用了路由表和节点之间的通信协议，使得节点能够快速查找目标节点和数据。

* 应用场景：DHT 协议通常用于构建 P2P 网络、分布式存储系统和分布式计算系统。它能够支持大规模节点和数据的分布式存储与检索。此协议关键在于数据的分布式存储和检索。

### IFPS & DHT

IFPS和DHT中存在一些哈希的做法，对于EDD问题有一定的参考价值。

在IPFS中，每个节点按照需求存储其所需要的数据块，且对这个数据块构建一个哈希链，其所链接的对象是当前文件数据块的下一个数据块的所在位置。当一个节点需要请求这个文件的时候，可以通过从文件起始块开始，按照哈希链的顺序，正确访问所有的文件。

在DHT中，每个节点都有一个哈希表，用来维护键值对(k1,v1)，其中k1是数据利用哈希函数之后得到的值，v1是原始文件值。当集群需要存储一个数据块的时候，每个节点需要对数据块做哈希，获得对应的k，判断其是否在当前节点所维护的区间中(即k值是否在需要维护的范围内)，如果是则存储(不存储对应的数据块，但是会知道对应的数据块的键值为k1，之后数据请求的时候需要用到)。当某一个节点需要请求一个数据的时候，则需要通过向周边节点迭代查找包含键值为k的键值对。例如，节点 E 可能首先向节点 D 发送请求，因为节点 D 的标识符更接近 K1 的标识符（此处的接近是指在哈希空间上接近）。节点 D 可能将查询请求转发给节点 C，直到最终找到负责存储 K1 的节点 A。最终，节点 A 将返回键值对（K1，V1）给节点 E。

### summary for p2p
这一部分的协议和应用大多关注的是数据的存储以及数据的去中心化存储。考虑到数据传输过程中存在的各种问题，可能采用类似IPFS和DHT中的一些思想构建EDD问题中的传输协议。

考虑在每个边缘节点上构建一个哈希表，云端将数据发送到一些带宽较高的服务器上(初始的文件发送)，让这些服务器存储部分数据块。接着每个节点构建一个哈希表，其可以通过高效的路由协议了解到各个数据块的存储位置，接着向这些节点请求其所需要的数据，一旦接受到k个数据块之后，立刻恢复出原始数据，并且将其拥有数据块的情况进行广播。

由于纠删码机制的存在，这样的做法虽然可以一定程度上加快数据传输（只需要等待k个数据块），但是可能存在引起边缘服务器网络之间的流量过大的问题（类似泛洪操作，节点之间频繁交流数据块的存储情况）。

在当前不考虑网络拓扑结构的情况下，可能不是一个比较好的方案；当考虑到网络拓扑结构的时候，采用分布式哈希表操作，节点可以快速定位并请求数据的优势可能可以有一定的体现。